<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“š Book Tracker (Online)</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f4f8; margin:0; padding:20px; display:flex; flex-direction:column; align-items:center; }
h1 { color:#333; }
.input-container, .category-tools { width:100%; max-width:500px; display:flex; flex-direction:column; margin-bottom:20px; }
input, select, button { margin:5px 0; padding:10px; font-size:16px; border-radius:5px; border:1px solid #ccc; }
button { cursor:pointer; background-color:#4CAF50; color:white; border:none; transition:0.3s; }
button:hover { background-color:#45a049; }
#clearAllBtn { background-color:#f44336; } #clearAllBtn:hover { background-color:#e53935; }
#exportBtn { background-color:#2196F3; } #exportBtn:hover { background-color:#1976D2; }
#importBtn { background-color:#FF9800; } #importBtn:hover { background-color:#F57C00; }
table { width:100%; max-width:750px; border-collapse:collapse; margin-top:20px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
th, td { padding:12px; text-align:left; border-bottom:1px solid #ddd; word-break:break-word; }
th { background-color:#f7f7f7; }
.delete-btn { padding:6px 12px; cursor:pointer; background:#f44336; color:white; border:none; border-radius:4px; }
.delete-btn:hover { background:#e53935; }
#totalBooks { margin-top:15px; font-weight:bold; font-size:18px; color:#333; text-align:center; }
@media (max-width:600px){ table, th, td { font-size:14px; } input, select, button { font-size:14px; padding:8px; } }
</style>
</head>
<body>
<h1>ðŸ“š Book Tracker (Online)</h1>

<div class="input-container">
<input type="text" id="bookName" placeholder="Enter book name">
<input type="number" id="bookAmount" placeholder="Enter amount">
<select id="bookCategory">
<option value="">Select Category</option>
<option>1st SEM</option>
<option>3rd SEM</option>
<option>5th SEM</option>
<option>7th SEM</option>
<option>Other</option>
</select>
<button onclick="addBook()">Add Book</button>
<button id="clearAllBtn" onclick="clearAllBooks()">Clear All Books</button>
<button id="exportBtn" onclick="exportToCSV()">Export to CSV</button>
<input type="file" id="importFile" accept=".csv" style="margin-top:10px;">
<button id="importBtn" onclick="importFromCSV()">Import from CSV</button>
</div>

<div class="category-tools">
<label><b>Filter by Category:</b></label>
<select id="filterCategory" onchange="renderTable()"><option value="All">All</option></select>
<label><b>Search:</b></label>
<input type="text" id="searchBox" placeholder="Search books..." oninput="renderTable()">
<label><b>Rename Category:</b></label>
<select id="renameFrom"></select>
<input type="text" id="renameTo" placeholder="New category name">
<button onclick="renameCategory()">Rename Category</button>
</div>

<table id="bookTable">
<thead>
<tr>
<th>Book Name</th>
<th>Amount</th>
<th>Category</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div id="totalBooks">Total Books: 0</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<script>
// âœ… Proper Firebase config (replace apiKey/projectId with dummy values)
const firebaseConfig = {
  apiKey: "DUMMY_API_KEY_123456",
  authDomain: "FAKE_PROJECT.firebaseapp.com",
  databaseURL: "https://book-inventory-bd5ba-default-rtdb.firebaseio.com",
  projectId: "dummy-project",
  storageBucket: "FAKE_PROJECT.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Add book
function addBook(){
  const name=document.getElementById("bookName").value.trim();
  const amount=document.getElementById("bookAmount").value.trim();
  const category=document.getElementById("bookCategory").value.trim();
  if(!name||!amount||!category){ alert("Fill all fields"); return; }
  db.ref("books").push({name, amount:Number(amount), category});
  document.getElementById("bookName").value="";
  document.getElementById("bookAmount").value="";
  document.getElementById("bookCategory").value="";
}

// Update book
function updateBook(id, field, value){
  if(field==="amount") value=Number(value);
  db.ref("books/"+id+"/"+field).set(value);
}

// Delete book
function deleteBook(id){ db.ref("books/"+id).remove(); }

// Clear all books
function clearAllBooks(){ if(confirm("Delete all books?")) db.ref("books").remove(); }

// Rename category
function renameCategory(){
  const from=document.getElementById("renameFrom").value;
  const to=document.getElementById("renameTo").value.trim();
  if(!from||!to){ alert("Select and enter new category"); return; }
  db.ref("books").once("value", snapshot=>{
    snapshot.forEach(child=>{
      const book=child.val();
      if(book.category===from) db.ref("books/"+child.key+"/category").set(to);
    });
  });
  document.getElementById("renameTo").value="";
}

// Export CSV
function exportToCSV(){
  db.ref("books").once("value", snapshot=>{
    let csv="Book Name,Amount,Category\n";
    snapshot.forEach(child=>{
      const b=child.val();
      csv+=`"${b.name}",${b.amount},"${b.category}"\n`;
    });
    const blob=new Blob([csv],{type:"text/csv"});
    const link=document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download="book_list.csv";
    document.body.appendChild(link); link.click(); document.body.removeChild(link);
  });
}

// Import CSV
function importFromCSV(){
  const fileInput=document.getElementById("importFile");
  if(!fileInput.files.length){ alert("Choose CSV first"); return; }
  const file=fileInput.files[0]; const reader=new FileReader();
  reader.onload=function(e){
    const lines=e.target.result.split("\n").map(l=>l.trim()).filter(l=>l);
    for(let i=1;i<lines.length;i++){
      const [name,amount,category]=lines[i].split(",").map(v=>v.replace(/(^"|"$)/g,"").trim());
      if(name && amount && category){
        db.ref("books").push({name, amount:Number(amount), category});
      }
    }
    fileInput.value="";
  };
  reader.readAsText(file);
}

// Render table
function renderTable(snapshot){
  const tbody=document.querySelector("#bookTable tbody");
  tbody.innerHTML="";
  const filter=document.getElementById("filterCategory").value;
  const search=document.getElementById("searchBox").value.toLowerCase();
  let total=0; const categories=new Set();

  snapshot.forEach(child=>{
    const b=child.val(); const id=child.key;
    categories.add(b.category);
    if((filter==="All"||b.category===filter)&&b.name.toLowerCase().includes(search)){
      total+=Number(b.amount);
      const row=document.createElement("tr");
      row.innerHTML=`<td contenteditable="true" onblur="updateBook('${id}','name',this.innerText)">${b.name}</td>
      <td contenteditable="true" onblur="updateBook('${id}','amount',this.innerText)">${b.amount}</td>
      <td contenteditable="true" onblur="updateBook('${id}','category',this.innerText)">${b.category}</td>
      <td><button class="delete-btn" onclick="deleteBook('${id}')">Delete</button></td>`;
      tbody.appendChild(row);
    }
  });

  const filterSelect=document.getElementById("filterCategory");
  const renameFromSelect=document.getElementById("renameFrom");
  filterSelect.innerHTML=`<option value="All">All</option>`;
  renameFromSelect.innerHTML="";
  categories.forEach(c=>{
    filterSelect.innerHTML+=`<option value="${c}">${c}</option>`;
    renameFromSelect.innerHTML+=`<option value="${c}">${c}</option>`;
  });

  document.getElementById("totalBooks").innerText="Total Books: "+total;
}

// Listen for DB changes
db.ref("books").on("value", snapshot=>renderTable(snapshot));
</script>
</body>
</html>
