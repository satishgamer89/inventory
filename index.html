<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“š Book Inventory with Login & Backup</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
  background: linear-gradient(135deg, #74ebd5, #9face6); 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  justify-content: center;
  padding: 20px; 
  min-height: 100vh; 
}

/* Heading */
h1 { color: #fff; margin-bottom: 30px; font-size: 2rem; text-align: center; }

/* Login Container */
#authContainer {
  width: 100%;
  max-width: 380px;
  background: #ffffff;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.2), 0 8px 15px rgba(0,0,0,0.1);
  animation: fadeIn 0.8s ease-in-out;
  text-align: center;
  transform-style: preserve-3d;
  perspective: 1000px;
}

#authContainer h2 {
  margin-bottom: 20px;
  font-size: 1.5rem;
  color: #333;
  font-weight: 600;
}

/* Inputs */
#authContainer input {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  font-size: 1rem;
  border: 1px solid #ddd;
  border-radius: 10px;
  transition: all 0.3s ease;
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
}

#authContainer input:focus {
  outline: none;
  border-color: #4CAF50;
  box-shadow: 0 0 8px rgba(76,175,80,0.5);
}

/* Buttons */
#authContainer button {
  width: 100%;
  padding: 14px;
  font-size: 1rem;
  border-radius: 10px;
  border: none;
  margin-top: 15px;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

#loginBtn {
  background: linear-gradient(135deg, #4CAF50, #2e7d32);
  color: white;
  font-weight: 600;
  box-shadow: 0 5px 15px rgba(46,125,50,0.3);
}
#loginBtn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(46,125,50,0.5);
}

#logoutBtn {
  background: linear-gradient(135deg, #f44336, #c62828);
  color: white;
  display: none;
  font-weight: 600;
  box-shadow: 0 5px 15px rgba(198,40,40,0.3);
}
#logoutBtn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(198,40,40,0.5);
}

/* Fade In Animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px) rotateX(10deg); }
  to { opacity: 1; transform: translateY(0) rotateX(0); }
}

/* Responsive */
@media(max-width: 480px){
  h1 { font-size: 1.6rem; }
  #authContainer { padding: 20px; }
  #authContainer h2 { font-size: 1.3rem; }
  #authContainer input, #authContainer button { font-size: 0.95rem; padding: 12px; }
}

/* Inventory styles remain same (shortened for clarity) */
.input-container, .category-tools { 
  width: 100%; max-width: 600px; background: #fff; padding: 20px; border-radius: 12px; 
  box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; 
}
.table-container {
  width: 100%;
  max-width: 700px;
  overflow-x: auto;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  background: #fff;
}
</style>
</head>
<body>
<h1>ðŸ“š Book Inventory with Backup</h1>

<!-- Login Form -->
<div id="authContainer">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button id="loginBtn">Login</button>
  <button id="logoutBtn" class="secondary">Logout</button>
</div>

<!-- Inventory App -->
<div id="appContainer" style="display:none;">
  <div class="input-container">
    <input type="text" id="bookName" placeholder="Enter book name">
    <input type="number" id="bookAmount" placeholder="Enter amount">
    <select id="bookCategory">
      <option value="">Select Category</option>
      <option>1st SEM</option>
      <option>3rd SEM</option>
      <option>5th SEM</option>
      <option>7th SEM</option>
      <option>Other</option>
    </select>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <button id="addBtn">Add Book</button>
      <button id="clearAllBtn" class="secondary">Clear All Books</button>
      <button id="exportBtn" class="info">Export CSV</button>
      <div class="file-input-wrapper">
        <label for="importFile">Choose CSV</label>
        <span id="fileName">No file chosen</span>
        <input type="file" id="importFile" accept=".csv">
      </div>
      <button id="importBtn" class="warning">Import CSV</button>
      <button id="backupBtn" class="info">Backup Now</button>
    </div>
    <div class="restore-controls" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
      <select id="restoreSelect"></select>
      <button id="restoreBtn" class="warning">Restore Backup</button>
      <button id="deleteBackupBtn" class="secondary">Delete Backup</button>
    </div>
  </div>

  <div class="category-tools">
    <label><b>Filter:</b></label>
    <select id="filterCategory"><option value="All">All</option></select>
    <label><b>Search:</b></label>
    <input type="text" id="searchBox" placeholder="Search...">
  </div>

  <div class="table-container">
    <table id="bookTable">
      <thead>
        <tr><th>Name</th><th>Amount</th><th>Category</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="totalBooks">Total Books: 0</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove, update, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDqOE9GsfwOedcwbVIR_fmEMRERcm8ikF4",
  authDomain: "book-inventory-bd5ba.firebaseapp.com",
  databaseURL: "https://book-inventory-bd5ba-default-rtdb.firebaseio.com",
  projectId: "book-inventory-bd5ba",
  storageBucket: "book-inventory-bd5ba.firebasestorage.app",
  messagingSenderId: "778702930923",
  appId: "1:778702930923:web:34a672ffda2eaa764f4fae",
  measurementId: "G-MW8W0RSYY2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const booksRef = ref(db, 'books');
const backupsRef = ref(db, 'backups');
let latestSnapshot = null;
let logoutTimer = null;

// --- AUTH LOGIC ---
const authContainer = document.getElementById("authContainer");
const appContainer = document.getElementById("appContainer");
const logoutBtn = document.getElementById("logoutBtn");

document.getElementById("loginBtn").addEventListener("click", ()=>{
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;
  signInWithEmailAndPassword(auth, email, password).catch(err=>alert(err.message));
});

logoutBtn.addEventListener("click", ()=> signOut(auth));

onAuthStateChanged(auth, user=>{
  if(user){
    authContainer.style.display="none";
    appContainer.style.display="block";
    logoutBtn.style.display="block";

    // Auto logout after 2 hours
    if(logoutTimer) clearTimeout(logoutTimer);
    logoutTimer = setTimeout(()=>{
      alert("â° Session expired. You have been logged out automatically.");
      signOut(auth);
    }, 2 * 60 * 60 * 1000); // 2 hours
  } else {
    authContainer.style.display="block";
    appContainer.style.display="none";
    logoutBtn.style.display="none";
    if(logoutTimer) clearTimeout(logoutTimer);
  }
});

// --- Inventory System (unchanged, shortened for clarity) ---
document.getElementById("importFile").addEventListener("change", e=>{
  const fileName = e.target.files.length ? e.target.files[0].name : "No file chosen";
  document.getElementById("fileName").textContent = fileName;
});

// ... (all your existing inventory backup/import/export code remains same here)
</script>
</body>
</html>
