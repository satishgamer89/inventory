<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“š Book Inventory (Dynamic Users)</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f4f8; margin:0; padding:20px; display:flex; flex-direction:column; align-items:center; }
h1 { color:#333; }
.input-container, .user-container { width:100%; max-width:500px; display:flex; flex-direction:column; margin-bottom:20px; }
input, select, button { margin:5px 0; padding:10px; font-size:16px; border-radius:5px; border:1px solid #ccc; }
button { cursor:pointer; background-color:#4CAF50; color:white; border:none; transition:0.3s; }
button:hover { background-color:#45a049; }
#clearAllBtn { background-color:#f44336; } #clearAllBtn:hover { background-color:#e53935; }
table { width:100%; max-width:750px; border-collapse:collapse; margin-top:20px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
th, td { padding:12px; text-align:left; border-bottom:1px solid #ddd; word-break:break-word; }
th { background-color:#f7f7f7; }
.delete-btn { padding:6px 12px; cursor:pointer; background:#f44336; color:white; border:none; border-radius:4px; }
.delete-btn:hover { background:#e53935; }
#totalBooks { margin-top:15px; font-weight:bold; font-size:18px; color:#333; text-align:center; }
</style>
</head>
<body>

<h1>ðŸ“š Book Inventory</h1>

<!-- User ID input -->
<div class="user-container">
<input type="text" id="userIdInput" placeholder="Enter your user ID">
<button id="setUserBtn">Set User</button>
</div>

<!-- Allowed users management -->
<div class="user-container">
<input type="text" id="newUserInput" placeholder="Add new allowed user">
<button id="addAllowedUserBtn">Add Allowed User</button>
</div>

<!-- Add book section -->
<div class="input-container">
<input type="text" id="bookName" placeholder="Enter book name">
<input type="number" id="bookAmount" placeholder="Enter amount">
<select id="bookCategory">
<option value="">Select Category</option>
<option>1st SEM</option>
<option>3rd SEM</option>
<option>5th SEM</option>
<option>7th SEM</option>
<option>Other</option>
</select>
<button id="addBtn">Add Book</button>
<button id="clearAllBtn">Clear All Books</button>
</div>

<table id="bookTable">
<thead><tr><th>Name</th><th>Amount</th><th>Category</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<div id="totalBooks">Total Books: 0</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyDqOE9GsfwOedcwbVIR_fmEMRERcm8ikF4",
    authDomain: "book-inventory-bd5ba.firebaseapp.com",
    databaseURL: "https://book-inventory-bd5ba-default-rtdb.firebaseio.com",
    projectId: "book-inventory-bd5ba",
    storageBucket: "book-inventory-bd5ba.firebasestorage.app",
    messagingSenderId: "778702930923",
    appId: "1:778702930923:web:34a672ffda2eaa764f4fae",
    measurementId: "G-MW8W0RSYY2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const booksRef = ref(db, 'books');

let allowedUsers = ["admin", "editor1"]; // initial allowed users
let currentUser = null;

// Set current user
document.getElementById('setUserBtn').addEventListener('click', ()=>{
    const userId = document.getElementById('userIdInput').value.trim();
    if(!userId){ alert("Enter a user ID"); return; }
    currentUser = userId;
    alert(`Hello ${currentUser}!`);
});

// Add new allowed user dynamically
document.getElementById('addAllowedUserBtn').addEventListener('click', ()=>{
    const newUser = document.getElementById('newUserInput').value.trim();
    if(!newUser){ alert("Enter a user ID to add"); return; }
    if(!allowedUsers.includes(newUser)){
        allowedUsers.push(newUser);
        alert(`User ${newUser} added to allowed users!`);
    } else {
        alert("User already allowed");
    }
    document.getElementById('newUserInput').value = '';
});

// Add book (only allowed users)
document.getElementById('addBtn').addEventListener('click', ()=>{
    if(!currentUser || !allowedUsers.includes(currentUser)){ 
        alert("You are not allowed to add books."); 
        return; 
    }
    const name = document.getElementById('bookName').value.trim();
    const amount = document.getElementById('bookAmount').value.trim();
    const category = document.getElementById('bookCategory').value.trim();
    if(!name || !amount || !category){ alert("Fill all fields"); return; }

    const newBookRef = push(booksRef);
    set(newBookRef, {name, amount:Number(amount), category, owner: currentUser});
    document.getElementById('bookName').value='';
    document.getElementById('bookAmount').value='';
    document.getElementById('bookCategory').value='';
});

// Clear all books (only allowed users)
document.getElementById('clearAllBtn').addEventListener('click', ()=>{
    if(!currentUser || !allowedUsers.includes(currentUser)){ alert("You are not allowed to clear books"); return; }
    if(confirm("Delete all books?")) remove(booksRef);
});

// Update/Delete functions with permissions
window.updateBook = function(id, field, value, owner){
    if(currentUser !== owner){ alert("You cannot edit this book"); return; }
    if(field==='amount') value = Number(value);
    update(ref(db, 'books/' + id), {[field]: value});
}
window.deleteBook = function(id, owner){
    if(currentUser !== owner){ alert("You cannot delete this book"); return; }
    remove(ref(db, 'books/' + id));
}

// Render table
onValue(booksRef, snapshot=>{
    const tbody = document.querySelector("#bookTable tbody");
    tbody.innerHTML='';
    let total = 0;
    snapshot.forEach(child=>{
        const b = child.val();
        const id = child.key;
        total += Number(b.amount);
        const isOwner = (currentUser === b.owner);
        const row = document.createElement('tr');
        row.innerHTML = `
            <td contenteditable="${isOwner}" onblur="${isOwner ? `updateBook('${id}','name',this.innerText,'${b.owner}')` : ''}">${b.name}</td>
            <td contenteditable="${isOwner}" onblur="${isOwner ? `updateBook('${id}','amount',this.innerText,'${b.owner}')` : ''}">${b.amount}</td>
            <td>${b.category}</td>
            <td>${isOwner ? `<button onclick="deleteBook('${id}','${b.owner}')">Delete</button>` : ''}</td>
        `;
        tbody.appendChild(row);
    });
    document.getElementById('totalBooks').innerText = `Total Books: ${total}`;
});
</script>
</body>
</html>
